# LangGraph Wikipedia Agent

Этот проект реализует агента для ответов на вопросы с опорой на Википедию.  
Агент поэтапно анализирует текст вопроса, определяет, какие факты следует выяснить, обращается к API Википедии, извлекает содержательные фрагменты текста, формирует итоговый ответ, а затем делает самопроверку.

Структура работы организована через граф состояний LangGraph, благодаря чему система проходит несколько связанных шагов: выделение поисковых запросов, загрузка страниц, разбиение текста на чанки, отбор наиболее релевантных данных, формирование ответа и последующая самопроверка.  
Если итоговая формулировка не согласуется с фактами или содержит неточности, агент автоматически переформулирует ответ.

---

## Возможности

- Разбор вопроса и выделение ключевых фактов, необходимых для ответа  
- Поиск соответствующих страниц в Википедии через публичное API  
- Извлечение текста из инфобокса и первых абзацев статьи  
- Разбиение текста на смысловые фрагменты (чанки) и выбор наиболее подходящих  
- Генерация ответа с опорой на найденную информацию  
- Самопроверка ответа и автоматическая перегенерация при необходимости  

---

## Архитектура агента

Агент состоит из следующих узлов графа:

- **extract_queries** — формирование пары (запрос в Вики - что нужно найти) на основе вопроса
- **fetch_wiki_pages** — поиск страниц Википедии по сформированным запросам  
- **select_best_chunk** — выбор релевантных чанков на основе кроссэнкодера (Top-5 чанков) и дозапроса в LLM
- **compose_final_answer** — первоначальная генерация ответа на основе полученных данных из Википедии
- **self_check_answer** — проверка ответа на соответствие фактам 
- **regenerate_answer** — перегенерация ответа, если обнаружены ошибки  

Если проверка подтверждает корректность ответа, граф завершается.  
Если были найдены противоречия, запускается ветка исправления.

---

## Структура проекта

app/
├──main.py         # FastAPI-приложение и эндпоинт /ask
├──graph.py        # описание графа агента на LangGraph
├──llm.py          # работа с OpenAI API
├──wiki_client.py  # запросы к Википедии и очистка HTML
└──model.py        # кроссэнкодер для работы агента
test_agent.py      # файл для тестирования агента
requirements.txt   # зависимости проекта
.env               # файл, хранящий ключ OPENAI_API_KEY

---

## Установка и запуск

### 1. Клонировать репозиторий

git clone https://github.com/AlexxPonomarenko/wiki_langgraph_agent.git
cd wiki_langgraph_agent

### 2. Установить зависимости

pip install -r requirements.txt

### 3. Указать ключ OpenAI

Создайте файл .env в корне проекта и добавьте в него:
OPENAI_API_KEY=ваш_ключ_от_OpenAI

Ключ используется модулем llm.py для обращения к модели.

### 4. Запуск сервера

Для запуска локального API выполните:

python -m app.main

Дождитесь, когда появится 
"INFO:     Application startup complete."

В новом терминале запустите файл с тестовым вопросом:
python .\test_agent.py
